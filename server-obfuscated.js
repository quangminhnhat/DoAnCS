const a0_0x520bbb=a0_0x1d9d;(function(_0x133bb9,_0x4c8b3e){const _0x23d876=a0_0x1d9d,_0x2ddf7d=_0x133bb9();while(!![]){try{const _0x83a204=-parseInt(_0x23d876(0x255))/0x1+parseInt(_0x23d876(0x214))/0x2+-parseInt(_0x23d876(0x27a))/0x3+-parseInt(_0x23d876(0x1cb))/0x4+parseInt(_0x23d876(0x26b))/0x5*(parseInt(_0x23d876(0x205))/0x6)+-parseInt(_0x23d876(0x21a))/0x7+-parseInt(_0x23d876(0x285))/0x8*(-parseInt(_0x23d876(0x1ea))/0x9);if(_0x83a204===_0x4c8b3e)break;else _0x2ddf7d['push'](_0x2ddf7d['shift']());}catch(_0x3d1b82){_0x2ddf7d['push'](_0x2ddf7d['shift']());}}}(a0_0x3a98,0xdc86e));process[a0_0x520bbb(0x25e)][a0_0x520bbb(0x20e)]!=='production'&&require(a0_0x520bbb(0x24b))[a0_0x520bbb(0x1c9)]();const express=require(a0_0x520bbb(0x1c5)),app=express(),path=require(a0_0x520bbb(0x1f3)),bcrypt=require(a0_0x520bbb(0x258)),sql=require('msnodesqlv8'),passport=require('passport'),flash=require(a0_0x520bbb(0x1d5)),session=require('express-session'),methodOverride=require(a0_0x520bbb(0x1b0)),{authenticateRole}=require('./roleAuth'),multer=require(a0_0x520bbb(0x20f)),fs=require('fs');app['use'](express['json']()),app['use'](methodOverride(a0_0x520bbb(0x28b))),app[a0_0x520bbb(0x1fe)](express['urlencoded']({'extended':![]}));const connectionString=a0_0x520bbb(0x274);app[a0_0x520bbb(0x1fe)](flash()),app[a0_0x520bbb(0x1fe)](session({'secret':process['env'][a0_0x520bbb(0x27c)],'resave':![],'saveUninitialized':![]}));function a0_0x3a98(){const _0x898c70=['\x0a\x20\x20\x20\x20SELECT\x20p.id,\x20s.full_name\x20AS\x20student_name,\x20p.amount,\x20p.payment_date\x0a\x20\x20\x20\x20FROM\x20payments\x20p\x0a\x20\x20\x20\x20JOIN\x20students\x20s\x20ON\x20p.student_id\x20=\x20s.id\x0a\x20\x20\x20\x20ORDER\x20BY\x20p.payment_date\x20DESC\x0a\x20\x20','redirect','INSERT\x20INTO\x20users\x20(username,\x20password,\x20role,\x20created_at,\x20updated_at)\x20VALUES\x20(?,\x20?,\x20?,\x20GETDATE(),\x20GETDATE());\x0a\x20\x20\x20\x20\x20\x20\x20INSERT\x20INTO\x20students\x20(user_id,\x20full_name,\x20email,\x20phone_number,\x20address,\x20date_of_birth,\x20created_at,\x20updated_at)\x0a\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x20id,\x20?,\x20?,\x20?,\x20?,\x20?,\x20GETDATE(),\x20GETDATE()\x0a\x20\x20\x20\x20\x20\x20\x20\x20FROM\x20users\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20username\x20=\x20?;\x0a\x20\x20\x20\x20\x20\x20','email','_method','\x0a\x20\x20\x20\x20INSERT\x20INTO\x20enrollments\x20(student_id,\x20class_id,\x20enrollment_date)\x0a\x20\x20\x20\x20VALUES\x20(?,\x20?,\x20?);\x0a\x20\x20','log','Class\x20fetch\x20error','Delete\x20payment\x20error:','Payment\x20insert\x20error:','editMaterial.ejs','logOut','Error\x20during\x20registration:','code','map','/uploads','Insert\x20error:','Update\x20error','\x0a\x20\x20\x20\x20INSERT\x20INTO\x20payments\x20(student_id,\x20amount,\x20payment_date)\x0a\x20\x20\x20\x20VALUES\x20(?,\x20?,\x20?);\x0a\x20\x20','/payments/new','toLocaleDateString','weekStart','isAuthenticated','schedule_date','method-override','/schedule/new','Material\x20uploaded\x20successfully.','Notification\x20sent\x20to\x20user\x20ID:','Update\x20error:','\x0a\x20\x20\x20\x20SELECT\x20c.*,\x20co.course_name,\x20t.full_name\x20AS\x20teacher_name\x0a\x20\x20\x20\x20FROM\x20classes\x20c\x0a\x20\x20\x20\x20JOIN\x20courses\x20co\x20ON\x20c.course_id\x20=\x20co.id\x0a\x20\x20\x20\x20JOIN\x20teachers\x20t\x20ON\x20c.teacher_id\x20=\x20t.id\x0a\x20\x20\x20\x20ORDER\x20BY\x20c.created_at\x20DESC\x0a\x20\x20','SELECT\x20id,\x20full_name\x20FROM\x20students','Delete\x20class\x20error:','register.ejs','material','student','/upload','\x0a\x20\x20\x20\x20\x20\x20SELECT\x20s.schedule_date,\x20s.start_time,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20c.class_name,\x20NULL\x20AS\x20teacher\x0a\x20\x20\x20\x20\x20\x20FROM\x20teachers\x20t\x0a\x20\x20\x20\x20\x20\x20JOIN\x20classes\x20c\x20\x20\x20\x20ON\x20t.id\x20=\x20c.teacher_id\x0a\x20\x20\x20\x20\x20\x20JOIN\x20schedules\x20s\x20\x20ON\x20c.id\x20=\x20s.class_id\x0a\x20\x20\x20\x20\x20\x20WHERE\x20t.user_id\x20=\x20?\x0a\x20\x20\x20\x20\x20\x20\x20\x20AND\x20s.schedule_date\x20BETWEEN\x20?\x20AND\x20?\x0a\x20\x20\x20\x20','/classes','SELECT\x20*\x20FROM\x20materials\x20ORDER\x20BY\x20uploaded_at\x20DESC','Address\x20is\x20required','SELECT\x20*\x20FROM\x20courses\x20ORDER\x20BY\x20start_date\x20DESC','Update\x20schedule\x20error:','DELETE\x20FROM\x20materials\x20WHERE\x20id\x20=\x20?','admin','max','express','Insert\x20course\x20error:','Teacher\x20fetch\x20error','user','config','/payments','1371060UapKWt','originalname','\x20\x0a\x20\x20\x20\x20\x20\x20SELECT\x20u.*\x0a\x20\x20\x20\x20\x20\x20FROM\x20users\x20u\x0a\x20\x20\x20\x20\x20\x20LEFT\x20JOIN\x20students\x20s\x20ON\x20u.id\x20=\x20s.user_id\x0a\x20\x20\x20\x20\x20\x20LEFT\x20JOIN\x20teachers\x20t\x20ON\x20u.id\x20=\x20t.user_id\x0a\x20\x20\x20\x20\x20\x20LEFT\x20JOIN\x20admins\x20a\x20ON\x20u.id\x20=\x20a.user_id\x0a\x20\x20\x20\x20\x20\x20WHERE\x20s.email\x20=\x20?\x20OR\x20t.email\x20=\x20?\x20OR\x20a.email\x20=\x20?\x0a\x20\x20\x20\x20','send','SELECT\x20file_path\x20FROM\x20materials\x20WHERE\x20id\x20=\x20?','Notification\x20sent\x20successfully!','index.ejs','Schedule\x20data:','File\x20deletion\x20error:','2-digit','express-flash','role','Missing\x20required\x20fields','addClass.ejs','mimetype','Database\x20insert\x20error','SELECT\x20*\x20FROM\x20classes\x20WHERE\x20id\x20=\x20?','Student\x20fetch\x20error','/courses/:id/edit','from','Only\x20staff\x20can\x20send\x20notifications.','console','/materials/:id/edit','\x0a\x20\x20\x20\x20UPDATE\x20enrollments\x0a\x20\x20\x20\x20SET\x20student_id\x20=\x20?,\x20class_id\x20=\x20?,\x20enrollment_date\x20=\x20?\x0a\x20\x20\x20\x20WHERE\x20id\x20=\x20?\x0a\x20\x20','iso','Update\x20failed','Thứ\x204','/classes/:id/edit','Thứ\x205','schedule','ejs','9dlmuoA','DELETE\x20FROM\x20courses\x20WHERE\x20id\x20=\x20?','Address','SELECT\x20*\x20FROM\x20enrollments\x20WHERE\x20id\x20=\x20?','Schedule\x20not\x20found','numeric','/classes/:id','Enrollment\x20insert\x20error:','File\x20uploaded\x20and\x20saved\x20to\x20database.','path','userList','Unauthorized\x20access','join','/logout','uploadMaterial.ejs','Name','post','Phone\x20number\x20is\x20required','addCourse.ejs','Thứ\x206','use','/login','filename','slice','Material\x20not\x20found','./pass-config','/payments/:id/edit','5008116ehGQPS','/schedules/:id','Chủ\x20nhật','Unhandled\x20error:','uploads','Date\x20of\x20birth\x20is\x20required','Email\x20is\x20required','Username\x20is\x20required','DELETE\x20FROM\x20payments\x20WHERE\x20id\x20=\x20?','NODE_ENV','multer','Database\x20error','getDate','Insert\x20notification\x20error:','editCourse','2674894YCQifT','Fetch\x20enrollments\x20error:','static','view\x20engine','start_time','/users/:id','9372363ZXRyVv','set','DELETE\x20FROM\x20users\x20WHERE\x20id\x20=\x20?','Fetch\x20payments\x20error:','/enrollments/:id/edit','/enrollments/new','existsSync','Salary\x20is\x20required\x20for\x20teachers','Missing\x20course_id\x20or\x20file.','unlink','status','editPayment.ejs','Update\x20enrollment\x20error:','Enrollment\x20not\x20found','/register','Delete\x20error','Logout\x20error','periodIndex','Thứ\x202','get','Insert\x20failed','Update\x20payment\x20error:','body','editSchedule.ejs','single','SQL\x20error:','length','/materials/:id','/notifications','\x0a\x20\x20\x20\x20INSERT\x20INTO\x20notifications\x20(user_id,\x20message)\x0a\x20\x20\x20\x20VALUES\x20(?,\x20?);\x0a\x20\x20','/enrollments/:id','Students\x20fetch\x20error','login.ejs','/upload-material','DELETE\x20FROM\x20enrollments\x20WHERE\x20id\x20=\x20?','Edit\x20fetch\x20error:','now','Not\x20found','SQL\x20Error:','salary','materials.ejs','\x0a\x20\x20\x20\x20UPDATE\x20courses\x20\x0a\x20\x20\x20\x20SET\x20course_name\x20=\x20?,\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20description\x20=\x20?,\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20start_date\x20=\x20?,\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20end_date\x20=\x20?,\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20updated_at\x20=\x20GETDATE()\x0a\x20\x20\x20\x20WHERE\x20id\x20=\x20?\x0a\x20\x20','SELECT\x20*\x20FROM\x20users\x20WHERE\x20id\x20=\x20?','Delete\x20schedule\x20error:','\x0a\x20\x20\x20\x20SELECT\x20e.id,\x20s.full_name\x20AS\x20student_name,\x20c.class_name,\x20e.enrollment_date\x0a\x20\x20\x20\x20FROM\x20enrollments\x20e\x0a\x20\x20\x20\x20JOIN\x20students\x20s\x20ON\x20e.student_id\x20=\x20s.id\x0a\x20\x20\x20\x20JOIN\x20classes\x20c\x20ON\x20e.class_id\x20=\x20c.id\x0a\x20\x20\x20\x20ORDER\x20BY\x20e.enrollment_date\x20DESC\x0a\x20\x20','/courses/new','setDate','/enrollments','/courses/:id','dotenv','\x0a\x20\x20\x20\x20UPDATE\x20schedules\x0a\x20\x20\x20\x20SET\x20class_id\x20=\x20?,\x20day_of_week\x20=\x20?,\x20schedule_date\x20=\x20?,\x20start_time\x20=\x20?,\x20end_time\x20=\x20?\x0a\x20\x20\x20\x20WHERE\x20id\x20=\x20?\x0a\x20\x20','INSERT\x20INTO\x20users\x20(username,\x20password,\x20role,\x20created_at,\x20updated_at)\x20VALUES\x20(?,\x20?,\x20?,\x20GETDATE(),\x20GETDATE());\x0a\x20\x20\x20\x20\x20\x20INSERT\x20INTO\x20teachers\x20(user_id,\x20full_name,\x20email,\x20phone_number,\x20address,\x20date_of_birth,\x20salary,\x20created_at,\x20updated_at)\x0a\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x20id,\x20?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20GETDATE(),\x20GETDATE()\x0a\x20\x20\x20\x20\x20\x20\x20\x20FROM\x20users\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20username\x20=\x20?;\x0a\x20\x20\x20\x20\x20\x20','session','Tiết\x20','/materials','User\x20not\x20found','/users/:id/edit','birthday','SELECT\x20id,\x20class_name\x20FROM\x20classes','477861cyvGVX','Payment\x20not\x20found','toISOString','bcrypt','params','enrollments.ejs','Delete\x20error:','Error\x20during\x20logout:','SELECT\x20*\x20FROM\x20courses\x20WHERE\x20id\x20=\x20?','env','error','listen','Insert\x20schedule\x20error:','/schedules','/schedule','Insert\x20material\x20error:','Newpayments.ejs','SELECT\x20*\x20FROM\x20materials\x20WHERE\x20id\x20=\x20?','phone','teacher','SELECT\x20*\x20FROM\x20payments\x20WHERE\x20id\x20=\x20?','Course\x20not\x20found','10OYRzCU','public','\x0a\x20\x20\x20\x20INSERT\x20INTO\x20schedules\x20(class_id,\x20day_of_week,\x20schedule_date,\x20start_time,\x20end_time)\x0a\x20\x20\x20\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?)\x0a\x20\x20','/users','Fetch\x20schedules\x20error:','\x0a\x20\x20\x20\x20\x09SELECT\x20u.id,\x20u.username,\x20u.role,\x20u.created_at,\x20u.updated_at,\x0a\x20\x20\x20\x20\x20\x20\x20COALESCE(s.full_name,\x20t.full_name,\x20a.full_name)\x20AS\x20full_name,\x0a\x20\x20\x20\x20\x20\x20\x20COALESCE(s.email,\x20t.email,\x20a.email)\x20AS\x20email,\x0a\x20\x20\x20\x20\x20\x20\x20COALESCE(s.phone_number,\x20t.phone_number,\x20a.phone_number)\x20AS\x20phone\x0aFROM\x20users\x20u\x0aLEFT\x20JOIN\x20students\x20s\x20ON\x20u.id\x20=\x20s.user_id\x0aLEFT\x20JOIN\x20teachers\x20t\x20ON\x20u.id\x20=\x20t.user_id\x0aLEFT\x20JOIN\x20admins\x20a\x20\x20\x20ON\x20u.id\x20=\x20a.user_id\x0aORDER\x20BY\x20u.created_at\x20DESC;\x0a\x20\x20','Delete\x20failed','Update\x20class\x20error:','diskStorage','Driver={ODBC\x20Driver\x2017\x20for\x20SQL\x20Server};Server=LAPTOP-ND7KAD0J;Database=DOANCS;Trusted_Connection=Yes;','rowsAffected','query','render','Thứ\x207','/courses','5258481WIDdcn','ERR_HTTP_HEADERS_SENT','SECRET_KEY','delete','file','Role:','/schedules/:id/edit','Fetch\x20materials\x20error:','Unauthorized\x20role','editClass.ejs','Thứ\x203','14470568NUVGAz','class_name'];a0_0x3a98=function(){return _0x898c70;};return a0_0x3a98();}const initalizePassport=require(a0_0x520bbb(0x203)),{time}=require(a0_0x520bbb(0x1e0));function a0_0x1d9d(_0x4f9c5e,_0x401354){const _0x3a9887=a0_0x3a98();return a0_0x1d9d=function(_0x1d9d8f,_0x2bae8d){_0x1d9d8f=_0x1d9d8f-0x1ab;let _0x20699d=_0x3a9887[_0x1d9d8f];return _0x20699d;},a0_0x1d9d(_0x4f9c5e,_0x401354);}initalizePassport(passport,_0x47791d=>{const _0x5c07ed=a0_0x520bbb,_0x938a76=_0x5c07ed(0x1cd);return new Promise((_0x4b1bd5,_0x12474b)=>{sql['query'](connectionString,_0x938a76,[_0x47791d,_0x47791d,_0x47791d],(_0x2fd9c8,_0x400b52)=>{const _0x341335=a0_0x1d9d;if(_0x2fd9c8)return console['error']('SQL\x20error:',_0x2fd9c8),_0x12474b(new Error(_0x2fd9c8));_0x400b52[_0x341335(0x234)]>0x0?_0x4b1bd5(_0x400b52[0x0]):_0x4b1bd5(null);});});},_0x59fe9b=>{const _0x1a057f=a0_0x520bbb,_0x355c99=_0x1a057f(0x244);return new Promise((_0x5859a3,_0x12e3e4)=>{const _0x906df3=_0x1a057f;sql[_0x906df3(0x276)](connectionString,_0x355c99,[_0x59fe9b],(_0x2b2162,_0x10d250)=>{const _0x577642=_0x906df3;if(_0x2b2162)return console['error'](_0x577642(0x233),_0x2b2162),_0x12e3e4(new Error(_0x2b2162));_0x10d250['length']>0x0?_0x5859a3(_0x10d250[0x0]):_0x5859a3(null);});});}),app[a0_0x520bbb(0x1fe)](passport['initialize']()),app['use'](passport[a0_0x520bbb(0x24e)]()),app[a0_0x520bbb(0x1fe)](methodOverride(a0_0x520bbb(0x28b))),app[a0_0x520bbb(0x21b)](a0_0x520bbb(0x217),a0_0x520bbb(0x1e9)),app[a0_0x520bbb(0x1fe)](a0_0x520bbb(0x296),express['static'](path['join'](__dirname,a0_0x520bbb(0x209))));const uploadFolder=path[a0_0x520bbb(0x1f6)](__dirname,a0_0x520bbb(0x209));!fs[a0_0x520bbb(0x220)](uploadFolder)&&fs['mkdirSync'](uploadFolder);const storage=multer[a0_0x520bbb(0x273)]({'destination':function(_0x491c32,_0x55b240,_0x103a55){_0x103a55(null,uploadFolder);},'filename':function(_0x990ad,_0x5a8905,_0x4ecfae){const _0x1a6a80=a0_0x520bbb,_0xb3472d=Date[_0x1a6a80(0x23e)]()+'-'+_0x5a8905[_0x1a6a80(0x1cc)];_0x4ecfae(null,_0xb3472d);}}),upload=multer({'storage':storage});app[a0_0x520bbb(0x1fa)](a0_0x520bbb(0x23b),checkAuthenticated,authenticateRole([a0_0x520bbb(0x1c3),a0_0x520bbb(0x268)]),(_0x11731b,_0x568581,_0x572e15)=>{_0x572e15();},upload[a0_0x520bbb(0x232)]('material'),(_0xb2a06a,_0x4e0425)=>{const _0x3c8072=a0_0x520bbb,{course_id:_0x49c447}=_0xb2a06a[_0x3c8072(0x230)],_0xd4705b=_0xb2a06a[_0x3c8072(0x27e)];if(!_0x49c447||!_0xd4705b)return _0x4e0425[_0x3c8072(0x224)](0x190)[_0x3c8072(0x1ce)](_0x3c8072(0x222));const _0x2050a5='\x0a\x20\x20\x20\x20INSERT\x20INTO\x20materials\x20(course_id,\x20file_name,\x20file_path,\x20mime_type)\x0a\x20\x20\x20\x20VALUES\x20(?,\x20?,\x20?,\x20?)\x0a\x20\x20',_0x1fb8dd=[_0x49c447,_0xd4705b['originalname'],path[_0x3c8072(0x1f6)](_0x3c8072(0x209),_0xd4705b[_0x3c8072(0x200)]),_0xd4705b[_0x3c8072(0x1d9)]];sql['query'](connectionString,_0x2050a5,_0x1fb8dd,_0x1d56d9=>{const _0x3b9ec8=_0x3c8072;if(_0x1d56d9)return console['error'](_0x3b9ec8(0x264),_0x1d56d9),_0x4e0425['status'](0x1f4)[_0x3b9ec8(0x1ce)](_0x3b9ec8(0x1da));console[_0x3b9ec8(0x28d)](_0x3b9ec8(0x1b2)),_0x4e0425[_0x3b9ec8(0x1ce)](_0x3b9ec8(0x1f2));});}),app['post']('/login',checkNotAuthenticated,passport['authenticate']('local',{'successRedirect':'/','failureRedirect':a0_0x520bbb(0x1ff),'failureFlash':!![]}));const mapRole={'subject1':a0_0x520bbb(0x1ba),'subject2':a0_0x520bbb(0x268),'subject3':'admin'};app['post'](a0_0x520bbb(0x236),checkAuthenticated,authenticateRole([a0_0x520bbb(0x1c3),a0_0x520bbb(0x268)]),(_0x28529a,_0x309ba9)=>{const _0x1ef101=a0_0x520bbb,{userId:_0x2d7aff,message:_0x4c7e93}=_0x28529a[_0x1ef101(0x230)],_0x267351=_0x28529a[_0x1ef101(0x1c8)]['role'];if(_0x267351!==_0x1ef101(0x1c3)&&_0x267351!==_0x1ef101(0x268))return _0x309ba9[_0x1ef101(0x224)](0x193)[_0x1ef101(0x1ce)](_0x1ef101(0x1df));if(!_0x2d7aff||!_0x4c7e93)return _0x309ba9[_0x1ef101(0x224)](0x190)[_0x1ef101(0x1ce)]('User\x20ID\x20and\x20message\x20are\x20required.');const _0x129923=_0x1ef101(0x237);sql[_0x1ef101(0x276)](connectionString,_0x129923,[_0x2d7aff,_0x4c7e93],_0x3593f9=>{const _0x14242c=_0x1ef101;if(_0x3593f9)return console[_0x14242c(0x25f)](_0x14242c(0x212),_0x3593f9),_0x309ba9[_0x14242c(0x224)](0x1f4)[_0x14242c(0x1ce)](_0x14242c(0x1da));console['log'](_0x14242c(0x1b3),_0x2d7aff),_0x309ba9[_0x14242c(0x224)](0xc9)['send'](_0x14242c(0x1d0));});}),app[a0_0x520bbb(0x22d)](a0_0x520bbb(0x250),checkAuthenticated,authenticateRole(['admin',a0_0x520bbb(0x268)]),(_0x15c306,_0x263164)=>{const _0x393b9b=a0_0x520bbb,_0x38914d=_0x393b9b(0x1be);sql[_0x393b9b(0x276)](connectionString,_0x38914d,(_0x21f336,_0x2fff29)=>{const _0x37e234=_0x393b9b;if(_0x21f336)return console[_0x37e234(0x25f)](_0x37e234(0x281),_0x21f336),_0x263164[_0x37e234(0x224)](0x1f4)[_0x37e234(0x1ce)](_0x37e234(0x210));_0x263164['render'](_0x37e234(0x242),{'materials':_0x2fff29,'user':_0x15c306[_0x37e234(0x1c8)]});});}),app[a0_0x520bbb(0x22d)](a0_0x520bbb(0x1e1),checkAuthenticated,authenticateRole([a0_0x520bbb(0x1c3),a0_0x520bbb(0x268)]),(_0x41bd6f,_0x5b6bd2)=>{const _0x21dfa2=a0_0x520bbb,_0xb89b7=_0x41bd6f[_0x21dfa2(0x259)]['id'],_0x582611=_0x21dfa2(0x266);sql['query'](connectionString,_0x582611,[_0xb89b7],(_0x4df4d6,_0x36d5b0)=>{const _0x3d1a14=_0x21dfa2;if(_0x4df4d6)return _0x5b6bd2[_0x3d1a14(0x224)](0x1f4)[_0x3d1a14(0x1ce)](_0x3d1a14(0x210));if(_0x36d5b0[_0x3d1a14(0x234)]===0x0)return _0x5b6bd2[_0x3d1a14(0x224)](0x194)['send'](_0x3d1a14(0x202));_0x5b6bd2[_0x3d1a14(0x277)](_0x3d1a14(0x291),{'material':_0x36d5b0[0x0],'user':_0x41bd6f[_0x3d1a14(0x1c8)]});});}),app[a0_0x520bbb(0x1fa)](a0_0x520bbb(0x235),checkAuthenticated,authenticateRole(['admin',a0_0x520bbb(0x268)]),(_0x23aa75,_0x1a06a9)=>{const _0x466332=a0_0x520bbb,{course_id:_0x320b78,file_name:_0x3e07a8}=_0x23aa75[_0x466332(0x230)],_0x213c5d='\x0a\x20\x20\x20\x20UPDATE\x20materials\x0a\x20\x20\x20\x20SET\x20course_id\x20=\x20?,\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20file_name\x20=\x20?,\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20uploaded_at\x20=\x20GETDATE()\x0a\x20\x20\x20\x20WHERE\x20id\x20=\x20?\x0a\x20\x20';sql['query'](connectionString,_0x213c5d,[_0x320b78,_0x3e07a8,_0x23aa75[_0x466332(0x259)]['id']],_0xe90d68=>{const _0x4ffa59=_0x466332;if(_0xe90d68)return console[_0x4ffa59(0x25f)]('Update\x20material\x20error:',_0xe90d68),_0x1a06a9[_0x4ffa59(0x224)](0x1f4)[_0x4ffa59(0x1ce)](_0x4ffa59(0x210));_0x1a06a9[_0x4ffa59(0x288)](_0x4ffa59(0x250));});}),app[a0_0x520bbb(0x27d)](a0_0x520bbb(0x235),checkAuthenticated,authenticateRole([a0_0x520bbb(0x1c3),a0_0x520bbb(0x268)]),(_0x29ff53,_0x4a127c)=>{const _0x422581=a0_0x520bbb,_0x2d1c9d=_0x29ff53[_0x422581(0x259)]['id'],_0x1098f6=_0x422581(0x1cf);sql['query'](connectionString,_0x1098f6,[_0x2d1c9d],(_0x4a4927,_0x2bc50d)=>{const _0x5cd552=_0x422581;if(_0x4a4927||_0x2bc50d[_0x5cd552(0x234)]===0x0)return _0x4a127c[_0x5cd552(0x224)](0x1f4)[_0x5cd552(0x1ce)](_0x5cd552(0x23f));const _0x4a9a9f=path[_0x5cd552(0x1f6)](__dirname,_0x2bc50d[0x0]['file_path']),_0x4eecf8=_0x5cd552(0x1c2);sql[_0x5cd552(0x276)](connectionString,_0x4eecf8,[_0x2d1c9d],_0x615990=>{const _0x8cb3be=_0x5cd552;if(_0x615990)return _0x4a127c[_0x8cb3be(0x224)](0x1f4)[_0x8cb3be(0x1ce)](_0x8cb3be(0x229));fs[_0x8cb3be(0x223)](_0x4a9a9f,_0x5b7482=>{const _0x5e247b=_0x8cb3be;if(_0x5b7482)console['error'](_0x5e247b(0x1d3),_0x5b7482);_0x4a127c['redirect'](_0x5e247b(0x250));});});});}),app[a0_0x520bbb(0x1fa)]('/courses',checkAuthenticated,authenticateRole('admin'),(_0x57ba61,_0x153ac5)=>{const _0x17385e=a0_0x520bbb,{course_name:_0x575ff6,description:_0x390690,start_date:_0x2193a1,end_date:_0x3214be}=_0x57ba61['body'],_0x3a6335=_0x57ba61['user'][_0x17385e(0x1d6)];if(_0x3a6335!==_0x17385e(0x1c3)&&_0x3a6335!==_0x17385e(0x268))return _0x153ac5[_0x17385e(0x224)](0x193)['send'](_0x17385e(0x1f5));if(!_0x575ff6||!_0x2193a1||!_0x3214be)return _0x153ac5[_0x17385e(0x224)](0x190)['send']('Missing\x20required\x20fields');const _0x44d3b1='\x0a\x20\x20\x20\x20INSERT\x20INTO\x20courses\x20(course_name,\x20description,\x20start_date,\x20end_date)\x0a\x20\x20\x20\x20VALUES\x20(?,\x20?,\x20?,\x20?)\x0a\x20\x20';sql[_0x17385e(0x276)](connectionString,_0x44d3b1,[_0x575ff6,_0x390690,_0x2193a1,_0x3214be],(_0x3c6243,_0x4e7526)=>{const _0x1fd012=_0x17385e;if(_0x3c6243)return console[_0x1fd012(0x25f)](_0x1fd012(0x1c6),_0x3c6243),_0x153ac5[_0x1fd012(0x224)](0x1f4)[_0x1fd012(0x1ce)]('Database\x20error');console['log']('Course\x20added:',_0x4e7526),_0x153ac5[_0x1fd012(0x288)]('/courses');});}),app['post']('/register',checkNotAuthenticated,authenticateRole(a0_0x520bbb(0x1c3)),async(_0x5dfa31,_0x882e4b)=>{const _0x25ac7e=a0_0x520bbb;try{const _0x4d4143=await bcrypt['hash'](_0x5dfa31[_0x25ac7e(0x230)]['Password'],0xa),_0x4feabd=_0x5dfa31[_0x25ac7e(0x230)][_0x25ac7e(0x1f9)],_0x176033=_0x5dfa31[_0x25ac7e(0x230)][_0x25ac7e(0x28a)],_0x3a34dc=_0x5dfa31[_0x25ac7e(0x230)][_0x25ac7e(0x253)],_0x3c24bc=_0x5dfa31[_0x25ac7e(0x230)][_0x25ac7e(0x267)],_0x3b3420=_0x5dfa31[_0x25ac7e(0x230)][_0x25ac7e(0x1ec)],_0x1df8e2=_0x5dfa31[_0x25ac7e(0x230)]['subject'],_0x43792f=_0x5dfa31[_0x25ac7e(0x230)][_0x25ac7e(0x241)],_0x15cddf=mapRole[_0x1df8e2];if(!_0x4feabd)return _0x882e4b[_0x25ac7e(0x224)](0x190)['send'](_0x25ac7e(0x20c));if(!_0x176033)return _0x882e4b[_0x25ac7e(0x224)](0x190)[_0x25ac7e(0x1ce)](_0x25ac7e(0x20b));if(!_0x3c24bc)return _0x882e4b[_0x25ac7e(0x224)](0x190)[_0x25ac7e(0x1ce)](_0x25ac7e(0x1fb));if(!_0x3b3420)return _0x882e4b[_0x25ac7e(0x224)](0x190)['send'](_0x25ac7e(0x1bf));if(!_0x3a34dc)return _0x882e4b[_0x25ac7e(0x224)](0x190)[_0x25ac7e(0x1ce)](_0x25ac7e(0x20a));if(_0x15cddf===_0x25ac7e(0x268)&&!_0x43792f)return _0x882e4b['status'](0x190)[_0x25ac7e(0x1ce)](_0x25ac7e(0x221));if(_0x15cddf===_0x25ac7e(0x1ba)){const _0x481d18=_0x25ac7e(0x289),_0x54ccd7=[_0x4feabd,_0x4d4143,_0x15cddf,_0x4feabd,_0x176033,_0x3c24bc,_0x3b3420,_0x3a34dc,_0x4feabd];sql[_0x25ac7e(0x276)](connectionString,_0x481d18,_0x54ccd7,(_0x41f862,_0x3cd5e7)=>{const _0x445eb0=_0x25ac7e;if(_0x41f862)return console[_0x445eb0(0x25f)]('Insert\x20error:',_0x41f862),_0x882e4b[_0x445eb0(0x224)](0x1f4)['send'](_0x445eb0(0x1da));console[_0x445eb0(0x28d)]('User\x20registered:',_0x3cd5e7);});}else{if(_0x15cddf===_0x25ac7e(0x268)){const _0x5b6dd0=_0x25ac7e(0x24d),_0x4096b0=[_0x4feabd,_0x4d4143,_0x15cddf,_0x4feabd,_0x176033,_0x3c24bc,_0x3b3420,_0x3a34dc,_0x43792f,_0x4feabd];sql['query'](connectionString,_0x5b6dd0,_0x4096b0,(_0x337d33,_0x8d5881)=>{const _0x53f9cd=_0x25ac7e;if(_0x337d33)return console[_0x53f9cd(0x25f)](_0x53f9cd(0x297),_0x337d33),_0x882e4b[_0x53f9cd(0x224)](0x1f4)[_0x53f9cd(0x1ce)](_0x53f9cd(0x1da));});}else{if(_0x15cddf===_0x25ac7e(0x1c3)){const _0x54d5fa='\x0a\x20\x20\x20\x20\x20\x20\x20\x20INSERT\x20INTO\x20users\x20(username,\x20password,\x20role,\x20created_at,\x20updated_at)\x20VALUES\x20(?,\x20?,\x20?,\x20GETDATE(),\x20GETDATE());\x0a\x20\x20\x20\x20\x20\x20\x20\x20INSERT\x20INTO\x20admins\x20(user_id,\x20full_name,\x20email,\x20phone_number,\x20created_at,\x20updated_at)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x20id,\x20?,\x20?,\x20?,\x20GETDATE(),\x20GETDATE()\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x20users\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20username\x20=\x20?;\x0a\x20\x20\x20\x20\x20\x20',_0x106018=[_0x4feabd,_0x4d4143,_0x15cddf,_0x4feabd,_0x176033,_0x3c24bc,_0x4feabd];sql[_0x25ac7e(0x276)](connectionString,_0x54d5fa,_0x106018,(_0x5b0b64,_0x52215d)=>{const _0x47b314=_0x25ac7e;try{if(_0x5b0b64)return console[_0x47b314(0x25f)](_0x47b314(0x297),_0x5b0b64),_0x882e4b[_0x47b314(0x224)](0x1f4)['send'](_0x47b314(0x1da));console[_0x47b314(0x28d)]('Admin\x20registered:',_0x52215d),_0x882e4b[_0x47b314(0x288)](_0x47b314(0x1ff));}catch(_0xa670f2){_0xa670f2['code']!==_0x47b314(0x27b)&&console[_0x47b314(0x25f)](_0x47b314(0x208),_0xa670f2);}});}}}}catch(_0x408d50){console['error'](_0x25ac7e(0x293),_0x408d50),_0x882e4b[_0x25ac7e(0x288)]('/register');}}),app['get'](a0_0x520bbb(0x26e),checkAuthenticated,authenticateRole('admin'),(_0x14a97e,_0x25fc42)=>{const _0x374ed3=a0_0x520bbb,_0x30c215=_0x374ed3(0x270);sql['query'](connectionString,_0x30c215,(_0x1186fd,_0x4c1777)=>{const _0x1f1dcb=_0x374ed3;if(_0x1186fd)return _0x25fc42[_0x1f1dcb(0x224)](0x1f4)['send'](_0x1f1dcb(0x210));_0x25fc42[_0x1f1dcb(0x277)](_0x1f1dcb(0x1f4),{'users':_0x4c1777});});}),app[a0_0x520bbb(0x22d)](a0_0x520bbb(0x252),checkAuthenticated,authenticateRole(a0_0x520bbb(0x1c3)),(_0x376c0b,_0x5b3856)=>{const _0x5bff27=a0_0x520bbb,_0x53962b=_0x376c0b['params']['id'],_0x38ce9f=_0x5bff27(0x244);sql['query'](connectionString,_0x38ce9f,[_0x53962b],(_0x436c9c,_0xf277eb)=>{const _0x1460f0=_0x5bff27;if(_0x436c9c||_0xf277eb[_0x1460f0(0x234)]===0x0)return _0x5b3856['status'](0x1f4)[_0x1460f0(0x1ce)](_0x1460f0(0x251));_0x5b3856['render']('editUser',{'user':_0xf277eb[0x0]});});}),app['post'](a0_0x520bbb(0x219),checkAuthenticated,authenticateRole(a0_0x520bbb(0x1c3)),(_0x3a7d6f,_0x3b806f)=>{const _0x2a3312=a0_0x520bbb,{username:_0x59f6e7,role:_0x1dd781}=_0x3a7d6f[_0x2a3312(0x230)],_0x1d43ba='\x0a\x20\x20\x20\x20UPDATE\x20users\x20SET\x20username\x20=\x20?,\x20role\x20=\x20?,\x20updated_at\x20=\x20GETDATE()\x0a\x20\x20\x20\x20WHERE\x20id\x20=\x20?\x0a\x20\x20';sql['query'](connectionString,_0x1d43ba,[_0x59f6e7,_0x1dd781,_0x3a7d6f[_0x2a3312(0x259)]['id']],_0x3b8dd6=>{const _0x57e73f=_0x2a3312;try{if(_0x3b8dd6)return console[_0x57e73f(0x25f)](_0x57e73f(0x1b4),_0x3b8dd6),_0x3b806f[_0x57e73f(0x224)](0x1f4)[_0x57e73f(0x1ce)](_0x57e73f(0x298));_0x3b806f['redirect'](_0x57e73f(0x26e));}catch(_0x20981e){_0x20981e[_0x57e73f(0x294)]!==_0x57e73f(0x27b)&&console[_0x57e73f(0x25f)]('Unhandled\x20error:',_0x20981e);}});}),app[a0_0x520bbb(0x27d)](a0_0x520bbb(0x219),checkAuthenticated,authenticateRole(a0_0x520bbb(0x1c3)),(_0x34b6e2,_0x41c786)=>{const _0x143694=a0_0x520bbb,_0x5f06fd=_0x143694(0x21c);sql[_0x143694(0x276)](connectionString,_0x5f06fd,[_0x34b6e2[_0x143694(0x259)]['id']],_0x2a77f3=>{const _0x2cd547=_0x143694;if(_0x2a77f3)return _0x41c786['status'](0x1f4)[_0x2cd547(0x1ce)](_0x2cd547(0x271));_0x41c786[_0x2cd547(0x288)](_0x2cd547(0x26e));});}),app[a0_0x520bbb(0x22d)]('/',(_0x36ad37,_0x4d3bd3)=>{const _0x5a5181=a0_0x520bbb;_0x4d3bd3['render'](_0x5a5181(0x1d1),{'user':_0x36ad37[_0x5a5181(0x1c8)]});}),app[a0_0x520bbb(0x22d)]('/login',checkNotAuthenticated,(_0x3d8d6c,_0x1fec25)=>{const _0x5a960a=a0_0x520bbb;_0x1fec25[_0x5a960a(0x277)](_0x5a960a(0x23a));}),app[a0_0x520bbb(0x22d)](a0_0x520bbb(0x228),checkAuthenticated,authenticateRole(a0_0x520bbb(0x1c3)),(_0xa2b328,_0x845b2)=>{const _0x400f71=a0_0x520bbb;_0x845b2['render'](_0x400f71(0x1b8));}),app[a0_0x520bbb(0x22d)](a0_0x520bbb(0x236),checkAuthenticated,(_0x3b886d,_0xa8fae8)=>{const _0x3ffee2=a0_0x520bbb;_0xa8fae8[_0x3ffee2(0x277)]('notifications.ejs',{'user':_0x3b886d[_0x3ffee2(0x1c8)]});}),app[a0_0x520bbb(0x22d)](a0_0x520bbb(0x247),checkAuthenticated,authenticateRole(a0_0x520bbb(0x1c3)),(_0x986377,_0x202c28)=>{const _0x2c77e4=a0_0x520bbb;_0x202c28[_0x2c77e4(0x277)](_0x2c77e4(0x1fc));}),app['get'](a0_0x520bbb(0x279),checkAuthenticated,authenticateRole(a0_0x520bbb(0x1c3)),(_0x1ee657,_0x3b4f74)=>{const _0x14bb09=a0_0x520bbb,_0x302bb1=_0x14bb09(0x1c0);sql[_0x14bb09(0x276)](connectionString,_0x302bb1,(_0xf7d9b6,_0x324cef)=>{const _0x176ce8=_0x14bb09;if(_0xf7d9b6)return console[_0x176ce8(0x25f)]('Fetch\x20courses\x20error:',_0xf7d9b6),_0x3b4f74[_0x176ce8(0x224)](0x1f4)[_0x176ce8(0x1ce)]('Database\x20error');_0x3b4f74['render']('courses.ejs',{'courses':_0x324cef,'user':_0x1ee657['user']});});}),app[a0_0x520bbb(0x22d)](a0_0x520bbb(0x1dd),checkAuthenticated,authenticateRole(a0_0x520bbb(0x1c3)),(_0x2fafd2,_0x5cd241)=>{const _0x4d2173=a0_0x520bbb,_0x28f784=_0x2fafd2['params']['id'],_0x38ecc0=_0x4d2173(0x25d);sql[_0x4d2173(0x276)](connectionString,_0x38ecc0,[_0x28f784],(_0x47cb79,_0xbf65a)=>{const _0x4418bb=_0x4d2173;if(_0x47cb79)return console[_0x4418bb(0x25f)](_0x4418bb(0x23d),_0x47cb79),_0x5cd241[_0x4418bb(0x224)](0x1f4)[_0x4418bb(0x1ce)](_0x4418bb(0x210));if(_0xbf65a['length']===0x0)return _0x5cd241[_0x4418bb(0x224)](0x194)[_0x4418bb(0x1ce)](_0x4418bb(0x26a));_0x5cd241['render'](_0x4418bb(0x213),{'course':_0xbf65a[0x0]});});}),app[a0_0x520bbb(0x1fa)](a0_0x520bbb(0x24a),checkAuthenticated,authenticateRole(a0_0x520bbb(0x1c3)),(_0x3f6a76,_0x2edcc4)=>{const _0x49b8c8=a0_0x520bbb,{course_name:_0x3bf29f,description:_0xe9e926,start_date:_0x17dac0,end_date:_0x4af726}=_0x3f6a76[_0x49b8c8(0x230)],_0x1d6a41=_0x3f6a76[_0x49b8c8(0x1c8)][_0x49b8c8(0x1d6)];if(_0x1d6a41!==_0x49b8c8(0x1c3)&&_0x1d6a41!=='teacher')return _0x2edcc4[_0x49b8c8(0x224)](0x193)[_0x49b8c8(0x1ce)](_0x49b8c8(0x1f5));if(!_0x3bf29f||!_0x17dac0||!_0x4af726)return _0x2edcc4[_0x49b8c8(0x224)](0x190)[_0x49b8c8(0x1ce)]('Missing\x20required\x20fields');const _0x3faeca=_0x49b8c8(0x243),_0x2ee07b=[_0x3bf29f,_0xe9e926,_0x17dac0,_0x4af726,_0x3f6a76[_0x49b8c8(0x259)]['id']];sql[_0x49b8c8(0x276)](connectionString,_0x3faeca,_0x2ee07b,(_0x5b69c1,_0x4d3231)=>{const _0x2c2bbd=_0x49b8c8;try{try{if(_0x5b69c1)return console['error']('Update\x20error:',_0x5b69c1),_0x2edcc4[_0x2c2bbd(0x224)](0x1f4)[_0x2c2bbd(0x1ce)](_0x2c2bbd(0x1e4));if(!_0x4d3231||_0x4d3231[_0x2c2bbd(0x275)]===0x0)return _0x2edcc4[_0x2c2bbd(0x224)](0x194)[_0x2c2bbd(0x1ce)]('Course\x20not\x20found');_0x2edcc4[_0x2c2bbd(0x288)](_0x2c2bbd(0x279));}catch(_0x21c30c){_0x21c30c[_0x2c2bbd(0x294)]!==_0x2c2bbd(0x27b)&&console[_0x2c2bbd(0x25f)](_0x2c2bbd(0x208),_0x21c30c);}}catch(_0xd81c7c){_0xd81c7c[_0x2c2bbd(0x294)]!==_0x2c2bbd(0x27b)&&console[_0x2c2bbd(0x25f)](_0x2c2bbd(0x208),_0xd81c7c);}});}),app[a0_0x520bbb(0x27d)]('/courses/:id',checkAuthenticated,authenticateRole(a0_0x520bbb(0x1c3)),(_0x1edba0,_0x13b471)=>{const _0x16e310=a0_0x520bbb,_0x5528c9=_0x16e310(0x1eb);sql[_0x16e310(0x276)](connectionString,_0x5528c9,[_0x1edba0[_0x16e310(0x259)]['id']],_0x3b7c40=>{const _0x431b4c=_0x16e310;if(_0x3b7c40)return console[_0x431b4c(0x25f)](_0x431b4c(0x25b),_0x3b7c40),_0x13b471[_0x431b4c(0x224)](0x1f4)[_0x431b4c(0x1ce)]('Delete\x20failed');_0x13b471['redirect']('/courses');});}),app[a0_0x520bbb(0x1fe)](express[a0_0x520bbb(0x216)](path[a0_0x520bbb(0x1f6)](__dirname,a0_0x520bbb(0x26c)))),app[a0_0x520bbb(0x27d)](a0_0x520bbb(0x1f7),(_0x2bd7e2,_0xb93192)=>{const _0x138527=a0_0x520bbb;_0x2bd7e2[_0x138527(0x292)](_0x30a776=>{const _0x6584a0=_0x138527;if(_0x30a776)return console[_0x6584a0(0x25f)](_0x6584a0(0x25c),_0x30a776),_0xb93192['status'](0x1f4)[_0x6584a0(0x1ce)](_0x6584a0(0x22a));_0xb93192[_0x6584a0(0x288)](_0x6584a0(0x1ff));});}),app['post']('/upload-material',checkAuthenticated,authenticateRole([a0_0x520bbb(0x1c3),a0_0x520bbb(0x268)]),upload[a0_0x520bbb(0x232)](a0_0x520bbb(0x1b9)),(_0x112045,_0x100564)=>{const _0x5bccf4=a0_0x520bbb,{course_id:_0x476b99}=_0x112045[_0x5bccf4(0x230)],_0x86c2cc=_0x112045['file'];if(!_0x476b99||!_0x86c2cc)return _0x100564[_0x5bccf4(0x224)](0x190)[_0x5bccf4(0x1ce)]('Missing\x20course_id\x20or\x20file.');const _0x1a2d51='\x0a\x20\x20\x20\x20INSERT\x20INTO\x20materials\x20(course_id,\x20file_name,\x20file_path,\x20mime_type)\x0a\x20\x20\x20\x20VALUES\x20(?,\x20?,\x20?,\x20?)\x0a\x20\x20',_0x20c61b=[_0x476b99,_0x86c2cc[_0x5bccf4(0x1cc)],path[_0x5bccf4(0x1f6)]('uploads',_0x86c2cc[_0x5bccf4(0x200)]),_0x86c2cc['mimetype']];sql[_0x5bccf4(0x276)](connectionString,_0x1a2d51,_0x20c61b,_0x636aa4=>{const _0x21d312=_0x5bccf4;if(_0x636aa4)return console[_0x21d312(0x25f)](_0x21d312(0x264),_0x636aa4),_0x100564['status'](0x1f4)[_0x21d312(0x1ce)]('Database\x20insert\x20error');console[_0x21d312(0x28d)]('Material\x20uploaded\x20successfully.'),_0x100564[_0x21d312(0x1ce)](_0x21d312(0x1f2));});}),app[a0_0x520bbb(0x22d)](a0_0x520bbb(0x263),checkAuthenticated,(_0x3ae488,_0x32b14b)=>{const _0x172979=a0_0x520bbb;let _0x4b4497;if(_0x3ae488[_0x172979(0x276)][_0x172979(0x1ad)])_0x4b4497=new Date(_0x3ae488[_0x172979(0x276)][_0x172979(0x1ad)]);else{const _0x33d1e0=new Date(),_0x251128=(_0x33d1e0['getDay']()+0x6)%0x7;_0x4b4497=new Date(_0x33d1e0),_0x4b4497[_0x172979(0x248)](_0x33d1e0[_0x172979(0x211)]()-_0x251128);}const _0x2e5bc2=_0x3ade38=>_0x3ade38[_0x172979(0x1ac)]('vi-VN',{'day':_0x172979(0x1d4),'month':_0x172979(0x1d4),'year':_0x172979(0x1ef)}),_0x4eab61=[_0x172979(0x22c),_0x172979(0x284),_0x172979(0x1e5),_0x172979(0x1e7),_0x172979(0x1fd),_0x172979(0x278),_0x172979(0x207)],_0xc48456=Array[_0x172979(0x1de)]({'length':0x7},(_0xa8ae59,_0x2ee456)=>{const _0xc4add6=_0x172979,_0x5736bc=new Date(_0x4b4497);return _0x5736bc[_0xc4add6(0x248)](_0x4b4497['getDate']()+_0x2ee456),{'name':_0x4eab61[_0x2ee456],'date':_0x2e5bc2(_0x5736bc),'iso':_0x5736bc['toISOString']()[_0xc4add6(0x201)](0x0,0xa)};}),_0x2234de=Array[_0x172979(0x1de)]({'length':0xf},(_0x48a794,_0x5bae21)=>_0x172979(0x24f)+(_0x5bae21+0x1)),_0x3b23da=_0x3ae488[_0x172979(0x1c8)]['id'],_0x3e5446=_0x3ae488[_0x172979(0x1c8)][_0x172979(0x1d6)],_0x3537ba=_0xc48456[0x0][_0x172979(0x1e3)],_0x49e90e=_0xc48456[0x6]['iso'];let _0x454c52,_0x479820;if(_0x3e5446===_0x172979(0x1ba))_0x454c52='\x0a\x20\x20\x20\x20\x20\x20SELECT\x20s.schedule_date,\x20s.start_time,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20c.class_name,\x20t.full_name\x20AS\x20teacher\x0a\x20\x20\x20\x20\x20\x20FROM\x20students\x20st\x0a\x20\x20\x20\x20\x20\x20JOIN\x20enrollments\x20e\x20ON\x20st.id\x20=\x20e.student_id\x0a\x20\x20\x20\x20\x20\x20JOIN\x20classes\x20c\x20\x20\x20\x20\x20ON\x20e.class_id\x20=\x20c.id\x0a\x20\x20\x20\x20\x20\x20JOIN\x20schedules\x20s\x20\x20\x20ON\x20c.id\x20=\x20s.class_id\x0a\x20\x20\x20\x20\x20\x20JOIN\x20teachers\x20t\x20\x20\x20\x20ON\x20c.teacher_id\x20=\x20t.id\x0a\x20\x20\x20\x20\x20\x20WHERE\x20st.user_id\x20=\x20?\x0a\x20\x20\x20\x20\x20\x20\x20\x20AND\x20s.schedule_date\x20BETWEEN\x20?\x20AND\x20?\x0a\x20\x20\x20\x20',_0x479820=[_0x3b23da,_0x3537ba,_0x49e90e];else{if(_0x3e5446===_0x172979(0x268))_0x454c52=_0x172979(0x1bc),_0x479820=[_0x3b23da,_0x3537ba,_0x49e90e];else return _0x32b14b[_0x172979(0x224)](0x193)[_0x172979(0x1ce)](_0x172979(0x282));}console[_0x172979(0x28d)](_0x172979(0x27f),_0x3e5446,'UserId:',_0x3b23da),console[_0x172979(0x28d)]('Date\x20Range:',_0x3537ba,'→',_0x49e90e),sql[_0x172979(0x276)](connectionString,_0x454c52,_0x479820,(_0x49ef5c,_0x359f10)=>{const _0x5421e2=_0x172979;if(_0x49ef5c)return console['error'](_0x5421e2(0x240),_0x49ef5c),_0x32b14b[_0x5421e2(0x224)](0x1f4)[_0x5421e2(0x1ce)](_0x5421e2(0x210));const _0x1ad9df={'07:00:00':0x0,'08:00:00':0x1,'09:00:00':0x2,'10:00:00':0x3,'11:00:00':0x4,'12:00:00':0x5,'13:00:00':0x6,'14:00:00':0x7,'15:00:00':0x8,'16:00:00':0x9,'17:00:00':0xa,'18:00:00':0xb,'19:00:00':0xc,'20:00:00':0xd,'21:00:00':0xe},_0x5da6f3=_0x359f10[_0x5421e2(0x295)](_0x298300=>{const _0x2f27db=_0x5421e2,_0x4bc075=_0x298300[_0x2f27db(0x1af)]['toISOString']()[_0x2f27db(0x201)](0x0,0xa),_0x108d56=_0x298300[_0x2f27db(0x218)][_0x2f27db(0x257)]()['slice'](0xb,0x13),_0x266f94=_0x1ad9df[_0x108d56];return{'time':_0x108d56,'date':_0x4bc075,'periodIndex':_0x266f94,'className':_0x298300[_0x2f27db(0x286)],'teacher':_0x298300[_0x2f27db(0x268)]||''};});console['log'](_0x5421e2(0x1d2),_0x5da6f3);const _0x247b7d=_0x5da6f3[_0x5421e2(0x234)]?Math[_0x5421e2(0x1c4)](..._0x5da6f3[_0x5421e2(0x295)](_0x3f70dc=>_0x3f70dc[_0x5421e2(0x22b)])):0x0,_0x987c42=new Date(_0x4b4497);_0x987c42['setDate'](_0x987c42[_0x5421e2(0x211)]()-0x7);const _0x3c7f9f=new Date(_0x4b4497);_0x3c7f9f['setDate'](_0x3c7f9f['getDate']()+0x7),_0x32b14b[_0x5421e2(0x277)](_0x5421e2(0x1e8),{'user':_0x3ae488['user'],'days':_0xc48456,'periods':_0x2234de,'scheduleData':_0x5da6f3,'weekStart':_0x4b4497['toISOString']()['slice'](0x0,0xa),'prevWeekStart':_0x987c42[_0x5421e2(0x257)]()[_0x5421e2(0x201)](0x0,0xa),'nextWeekStart':_0x3c7f9f[_0x5421e2(0x257)]()[_0x5421e2(0x201)](0x0,0xa),'maxPeriod':_0x247b7d});});}),app['get'](a0_0x520bbb(0x1b1),checkAuthenticated,authenticateRole('admin'),(_0x33670a,_0x2c4522)=>{const _0x460ed2=a0_0x520bbb,_0x53c124=_0x460ed2(0x254);sql[_0x460ed2(0x276)](connectionString,_0x53c124,(_0x160599,_0x15e286)=>{const _0x1092cf=_0x460ed2;if(_0x160599)return _0x2c4522['status'](0x1f4)[_0x1092cf(0x1ce)](_0x1092cf(0x28e));_0x2c4522[_0x1092cf(0x277)]('newSchedule.ejs',{'classes':_0x15e286,'user':_0x33670a[_0x1092cf(0x1c8)]});});}),app[a0_0x520bbb(0x1fa)](a0_0x520bbb(0x262),checkAuthenticated,authenticateRole(a0_0x520bbb(0x1c3)),(_0xba9925,_0x301aba)=>{const _0x410b5c=a0_0x520bbb,{class_id:_0x5f43b5,day_of_week:_0x3a69f8,schedule_date:_0x1db2ed,start_time:_0x2093ae,end_time:_0x354b06}=_0xba9925[_0x410b5c(0x230)],_0x541195=_0x410b5c(0x26d),_0x1e7a67=[_0x5f43b5,_0x3a69f8,_0x1db2ed,_0x2093ae,_0x354b06];sql[_0x410b5c(0x276)](connectionString,_0x541195,_0x1e7a67,_0x43121d=>{const _0x3a19e8=_0x410b5c;if(_0x43121d)return console['error'](_0x3a19e8(0x261),_0x43121d),_0x301aba['status'](0x1f4)['send'](_0x3a19e8(0x22e));_0x301aba['redirect'](_0x3a19e8(0x263));});}),app['get'](a0_0x520bbb(0x262),checkAuthenticated,authenticateRole('admin'),(_0x2d7427,_0x1dafde)=>{const _0x21af17=a0_0x520bbb,_0x3f03cc='\x0a\x20\x20\x20\x20SELECT\x20s.*,\x20c.class_name\x0a\x20\x20\x20\x20FROM\x20schedules\x20s\x0a\x20\x20\x20\x20JOIN\x20classes\x20c\x20ON\x20s.class_id\x20=\x20c.id\x0a\x20\x20\x20\x20ORDER\x20BY\x20s.schedule_date\x20DESC\x0a\x20\x20';sql[_0x21af17(0x276)](connectionString,_0x3f03cc,(_0x3798f7,_0x4f98df)=>{const _0x3e5ea9=_0x21af17;if(_0x3798f7)return console[_0x3e5ea9(0x25f)](_0x3e5ea9(0x26f),_0x3798f7),_0x1dafde[_0x3e5ea9(0x224)](0x1f4)[_0x3e5ea9(0x1ce)](_0x3e5ea9(0x210));_0x1dafde[_0x3e5ea9(0x277)]('schedules.ejs',{'schedules':_0x4f98df,'user':_0x2d7427[_0x3e5ea9(0x1c8)]});});}),app[a0_0x520bbb(0x22d)](a0_0x520bbb(0x280),checkAuthenticated,authenticateRole('admin'),(_0x305d52,_0x2d44d4)=>{const _0x5e0322=a0_0x520bbb,_0x4aa35c=_0x305d52[_0x5e0322(0x259)]['id'],_0x15d963='SELECT\x20*\x20FROM\x20schedules\x20WHERE\x20id\x20=\x20?',_0x459836='SELECT\x20id,\x20class_name\x20FROM\x20classes';sql[_0x5e0322(0x276)](connectionString,_0x15d963,[_0x4aa35c],(_0x7a15e8,_0x283521)=>{const _0x2eca1c=_0x5e0322;if(_0x7a15e8||_0x283521['length']===0x0)return _0x2d44d4[_0x2eca1c(0x224)](0x1f4)[_0x2eca1c(0x1ce)](_0x2eca1c(0x1ee));sql[_0x2eca1c(0x276)](connectionString,_0x459836,(_0x20979a,_0x4a7e60)=>{const _0x14c6f3=_0x2eca1c;if(_0x20979a)return _0x2d44d4[_0x14c6f3(0x224)](0x1f4)['send'](_0x14c6f3(0x28e));_0x2d44d4[_0x14c6f3(0x277)](_0x14c6f3(0x231),{'schedule':_0x283521[0x0],'classes':_0x4a7e60,'user':_0x305d52[_0x14c6f3(0x1c8)]});});});}),app['post'](a0_0x520bbb(0x206),checkAuthenticated,authenticateRole('admin'),(_0x721172,_0x10f819)=>{const _0x35a36b=a0_0x520bbb,{class_id:_0x301dda,day_of_week:_0x4fa953,schedule_date:_0x16252e,start_time:_0x39c0db,end_time:_0x501544}=_0x721172[_0x35a36b(0x230)],_0x5e0706=_0x35a36b(0x24c),_0x57d4bb=[_0x301dda,_0x4fa953,_0x16252e,_0x39c0db,_0x501544,_0x721172[_0x35a36b(0x259)]['id']];sql[_0x35a36b(0x276)](connectionString,_0x5e0706,_0x57d4bb,_0x2a1a5a=>{const _0x1a12cd=_0x35a36b;if(_0x2a1a5a)return console['error'](_0x1a12cd(0x1c1),_0x2a1a5a),_0x10f819[_0x1a12cd(0x224)](0x1f4)[_0x1a12cd(0x1ce)]('Update\x20failed');_0x10f819[_0x1a12cd(0x288)]('/schedules');});}),app[a0_0x520bbb(0x27d)](a0_0x520bbb(0x206),checkAuthenticated,authenticateRole(a0_0x520bbb(0x1c3)),(_0x42bb66,_0x289638)=>{const _0x14a8ef=a0_0x520bbb,_0x5dd917='DELETE\x20FROM\x20schedules\x20WHERE\x20id\x20=\x20?';sql[_0x14a8ef(0x276)](connectionString,_0x5dd917,[_0x42bb66[_0x14a8ef(0x259)]['id']],_0x29954b=>{const _0x252aa4=_0x14a8ef;if(_0x29954b)return console[_0x252aa4(0x25f)](_0x252aa4(0x245),_0x29954b),_0x289638[_0x252aa4(0x224)](0x1f4)[_0x252aa4(0x1ce)](_0x252aa4(0x271));_0x289638['redirect'](_0x252aa4(0x262));});}),app[a0_0x520bbb(0x1fa)](a0_0x520bbb(0x262),checkAuthenticated,authenticateRole('admin'),(_0x17606e,_0x325ffe)=>{const _0x2ff35c=a0_0x520bbb,{class_id:_0x4fe018,day_of_week:_0x1ee662,schedule_date:_0x275092,start_time:_0x44661f,end_time:_0x362c6f}=_0x17606e[_0x2ff35c(0x230)],_0x506687='\x0a\x20\x20\x20\x20INSERT\x20INTO\x20schedules\x20(class_id,\x20day_of_week,\x20schedule_date,\x20start_time,\x20end_time)\x0a\x20\x20\x20\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?)\x0a\x20\x20',_0x2a1502=[_0x4fe018,_0x1ee662,_0x275092,_0x44661f,_0x362c6f];sql[_0x2ff35c(0x276)](connectionString,_0x506687,_0x2a1502,_0x2a895a=>{const _0x48df30=_0x2ff35c;if(_0x2a895a)return console['error'](_0x48df30(0x261),_0x2a895a),_0x325ffe[_0x48df30(0x224)](0x1f4)[_0x48df30(0x1ce)]('Insert\x20failed');_0x325ffe[_0x48df30(0x288)](_0x48df30(0x262));});}),app[a0_0x520bbb(0x1fa)](a0_0x520bbb(0x1bd),checkAuthenticated,authenticateRole([a0_0x520bbb(0x1c3),'teacher']),(_0x2587f2,_0x29fd04)=>{const _0x1bd033=a0_0x520bbb,{class_name:_0x2514dd,course_id:_0x1f1dbe,teacher_id:_0x50af8e,start_time:_0x752494,end_time:_0x71e2d4}=_0x2587f2[_0x1bd033(0x230)];if(!_0x2514dd||!_0x1f1dbe||!_0x50af8e||!_0x752494||!_0x71e2d4)return _0x29fd04[_0x1bd033(0x224)](0x190)[_0x1bd033(0x1ce)](_0x1bd033(0x1d7));const _0x4b8e50='\x0a\x20\x20\x20\x20INSERT\x20INTO\x20classes\x20(class_name,\x20course_id,\x20teacher_id,\x20start_time,\x20end_time)\x0a\x20\x20\x20\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?);\x0a\x20\x20';sql[_0x1bd033(0x276)](connectionString,_0x4b8e50,[_0x2514dd,_0x1f1dbe,_0x50af8e,_0x752494,_0x71e2d4],_0x295bf7=>{const _0x3a5e66=_0x1bd033;if(_0x295bf7)return console[_0x3a5e66(0x25f)]('Insert\x20class\x20error:',_0x295bf7),_0x29fd04[_0x3a5e66(0x224)](0x1f4)[_0x3a5e66(0x1ce)](_0x3a5e66(0x210));_0x29fd04[_0x3a5e66(0x288)]('/classes');});}),app[a0_0x520bbb(0x22d)]('/classes',checkAuthenticated,authenticateRole([a0_0x520bbb(0x1c3),a0_0x520bbb(0x268)]),(_0x255649,_0x10f31a)=>{const _0x4def53=a0_0x520bbb,_0x579537=_0x4def53(0x1b5);sql[_0x4def53(0x276)](connectionString,_0x579537,(_0x592b81,_0x3f5a49)=>{const _0x15a3ba=_0x4def53;if(_0x592b81)return console[_0x15a3ba(0x25f)]('Fetch\x20classes\x20error:',_0x592b81),_0x10f31a[_0x15a3ba(0x224)](0x1f4)[_0x15a3ba(0x1ce)]('Database\x20error');_0x10f31a[_0x15a3ba(0x277)]('classes.ejs',{'classes':_0x3f5a49,'user':_0x255649[_0x15a3ba(0x1c8)]});});}),app[a0_0x520bbb(0x22d)](a0_0x520bbb(0x1e6),checkAuthenticated,authenticateRole(['admin',a0_0x520bbb(0x268)]),(_0x4b8016,_0x2cff7d)=>{const _0x5ebdf4=a0_0x520bbb,_0x44bf07=_0x4b8016[_0x5ebdf4(0x259)]['id'],_0x3b800c=_0x5ebdf4(0x1db),_0x4683b8='SELECT\x20id,\x20course_name\x20FROM\x20courses',_0x25f46f='SELECT\x20id,\x20full_name\x20FROM\x20teachers';sql[_0x5ebdf4(0x276)](connectionString,_0x3b800c,[_0x44bf07],(_0x35458c,_0xa8a614)=>{const _0x207ab4=_0x5ebdf4;if(_0x35458c||_0xa8a614[_0x207ab4(0x234)]===0x0)return _0x2cff7d[_0x207ab4(0x224)](0x1f4)[_0x207ab4(0x1ce)]('Class\x20not\x20found');sql[_0x207ab4(0x276)](connectionString,_0x4683b8,(_0x3e478c,_0x5e8dd1)=>{const _0xf5c0f8=_0x207ab4;if(_0x3e478c)return _0x2cff7d[_0xf5c0f8(0x224)](0x1f4)[_0xf5c0f8(0x1ce)]('Course\x20fetch\x20error');sql[_0xf5c0f8(0x276)](connectionString,_0x25f46f,(_0x55389d,_0x59ed11)=>{const _0x3a4b5e=_0xf5c0f8;if(_0x55389d)return _0x2cff7d['status'](0x1f4)['send'](_0x3a4b5e(0x1c7));_0x2cff7d[_0x3a4b5e(0x277)](_0x3a4b5e(0x283),{'classItem':_0xa8a614[0x0],'courses':_0x5e8dd1,'teachers':_0x59ed11,'user':_0x4b8016[_0x3a4b5e(0x1c8)]});});});});}),app[a0_0x520bbb(0x1fa)](a0_0x520bbb(0x1f0),checkAuthenticated,authenticateRole([a0_0x520bbb(0x1c3),a0_0x520bbb(0x268)]),(_0x228387,_0x35f9f1)=>{const _0x52b292=a0_0x520bbb,{class_name:_0x52d4b4,course_id:_0x544f49,teacher_id:_0x40f84a,start_time:_0x407451,end_time:_0x5253a1}=_0x228387[_0x52b292(0x230)],_0xf70fb7='\x0a\x20\x20\x20\x20UPDATE\x20classes\x0a\x20\x20\x20\x20SET\x20class_name\x20=\x20?,\x20course_id\x20=\x20?,\x20teacher_id\x20=\x20?,\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20start_time\x20=\x20?,\x20end_time\x20=\x20?,\x20updated_at\x20=\x20GETDATE()\x0a\x20\x20\x20\x20WHERE\x20id\x20=\x20?\x0a\x20\x20',_0x4e75ef=[_0x52d4b4,_0x544f49,_0x40f84a,_0x407451,_0x5253a1,_0x228387[_0x52b292(0x259)]['id']];sql[_0x52b292(0x276)](connectionString,_0xf70fb7,_0x4e75ef,_0x2f6854=>{const _0x5dca73=_0x52b292;try{if(_0x2f6854)return console[_0x5dca73(0x25f)](_0x5dca73(0x272),_0x2f6854),_0x35f9f1['status'](0x1f4)['send'](_0x5dca73(0x1e4));_0x35f9f1['redirect'](_0x5dca73(0x1bd));}catch(_0x4eb229){_0x4eb229['code']!==_0x5dca73(0x27b)&&console[_0x5dca73(0x25f)]('Unhandled\x20error:',_0x4eb229);}});}),app[a0_0x520bbb(0x27d)]('/classes/:id',checkAuthenticated,authenticateRole('admin'),(_0x384974,_0x340d82)=>{const _0x4efe58=a0_0x520bbb,_0x35bb7d=_0x384974[_0x4efe58(0x259)]['id'],_0x508794='DELETE\x20FROM\x20classes\x20WHERE\x20id\x20=\x20?';sql[_0x4efe58(0x276)](connectionString,_0x508794,[_0x35bb7d],_0x52ce90=>{const _0x4a2b60=_0x4efe58;if(_0x52ce90)return console[_0x4a2b60(0x25f)](_0x4a2b60(0x1b7),_0x52ce90),_0x340d82['status'](0x1f4)['send']('Delete\x20failed.xóa\x20hết\x20học\x20viên\x20trong\x20lớp\x20nếu\x20chưa\x20xóa');_0x340d82[_0x4a2b60(0x288)](_0x4a2b60(0x1bd));});}),app[a0_0x520bbb(0x1fa)](a0_0x520bbb(0x21f),checkAuthenticated,authenticateRole('admin'),(_0x403118,_0x5899f7)=>{const _0x1dc436=a0_0x520bbb,{student_id:_0x54c07e,class_id:_0x4b99e5,enrollment_date:_0x34935a}=_0x403118[_0x1dc436(0x230)];if(!_0x54c07e||!_0x4b99e5||!_0x34935a)return _0x5899f7[_0x1dc436(0x224)](0x190)['send'](_0x1dc436(0x1d7));const _0x1d2b34=_0x1dc436(0x28c);sql[_0x1dc436(0x276)](connectionString,_0x1d2b34,[_0x54c07e,_0x4b99e5,_0x34935a],_0x41eca7=>{const _0x280676=_0x1dc436;if(_0x41eca7)return console[_0x280676(0x25f)](_0x280676(0x1f1),_0x41eca7),_0x5899f7[_0x280676(0x224)](0x1f4)['send'](_0x280676(0x210));_0x5899f7['redirect'](_0x280676(0x249));});}),app[a0_0x520bbb(0x22d)]('/enrollments',checkAuthenticated,authenticateRole(a0_0x520bbb(0x1c3)),(_0x2caabe,_0x2816cc)=>{const _0x40b2c2=a0_0x520bbb,_0x10ef48=_0x40b2c2(0x246);sql[_0x40b2c2(0x276)](connectionString,_0x10ef48,(_0x24e98f,_0x56ec33)=>{const _0x1a0ce4=_0x40b2c2;if(_0x24e98f)return console[_0x1a0ce4(0x25f)](_0x1a0ce4(0x215),_0x24e98f),_0x2816cc['status'](0x1f4)[_0x1a0ce4(0x1ce)](_0x1a0ce4(0x210));_0x2816cc[_0x1a0ce4(0x277)](_0x1a0ce4(0x25a),{'enrollments':_0x56ec33,'user':_0x2caabe[_0x1a0ce4(0x1c8)]});});}),app[a0_0x520bbb(0x22d)](a0_0x520bbb(0x21e),checkAuthenticated,authenticateRole(a0_0x520bbb(0x1c3)),(_0x3742ba,_0x3f9217)=>{const _0x3f8211=a0_0x520bbb,_0x5f2b17=_0x3742ba[_0x3f8211(0x259)]['id'],_0x2c7d7d=_0x3f8211(0x1ed),_0xcffb1a=_0x3f8211(0x1b6),_0x3e6a9c=_0x3f8211(0x254);sql['query'](connectionString,_0x2c7d7d,[_0x5f2b17],(_0x23dd69,_0x402bf6)=>{const _0x366a35=_0x3f8211;if(_0x23dd69||_0x402bf6[_0x366a35(0x234)]===0x0)return _0x3f9217[_0x366a35(0x224)](0x194)[_0x366a35(0x1ce)](_0x366a35(0x227));const _0x1b50e8=_0x402bf6[0x0];sql[_0x366a35(0x276)](connectionString,_0xcffb1a,(_0x50b3ee,_0x2ef7ed)=>{const _0x1a1e11=_0x366a35;if(_0x50b3ee)return _0x3f9217[_0x1a1e11(0x224)](0x1f4)[_0x1a1e11(0x1ce)](_0x1a1e11(0x239));sql[_0x1a1e11(0x276)](connectionString,_0x3e6a9c,(_0x44a5be,_0x898afe)=>{const _0x5eff18=_0x1a1e11;if(_0x44a5be)return _0x3f9217['status'](0x1f4)[_0x5eff18(0x1ce)]('Classes\x20fetch\x20error');_0x3f9217[_0x5eff18(0x277)]('editEnrollment.ejs',{'enrollment':_0x1b50e8,'students':_0x2ef7ed,'classes':_0x898afe,'user':_0x3742ba[_0x5eff18(0x1c8)]});});});});}),app[a0_0x520bbb(0x1fa)]('/enrollments/:id',checkAuthenticated,authenticateRole('admin'),(_0x2d341b,_0x107162)=>{const _0x201f49=a0_0x520bbb,{student_id:_0x50443c,class_id:_0x3f67f0,enrollment_date:_0x5c06c5}=_0x2d341b[_0x201f49(0x230)],_0x578f27=_0x201f49(0x1e2);sql[_0x201f49(0x276)](connectionString,_0x578f27,[_0x50443c,_0x3f67f0,_0x5c06c5,_0x2d341b['params']['id']],_0x30db24=>{const _0x1d6fb7=_0x201f49;if(_0x30db24)return console['error'](_0x1d6fb7(0x226),_0x30db24),_0x107162['status'](0x1f4)['send']('Update\x20failed');_0x107162['redirect']('/enrollments');});}),app[a0_0x520bbb(0x27d)](a0_0x520bbb(0x238),checkAuthenticated,authenticateRole(a0_0x520bbb(0x1c3)),(_0x2780a6,_0x40a390)=>{const _0x37c59e=a0_0x520bbb,_0x202406=_0x37c59e(0x23c);sql['query'](connectionString,_0x202406,[_0x2780a6[_0x37c59e(0x259)]['id']],_0x590a1f=>{const _0x51343d=_0x37c59e;if(_0x590a1f)return console[_0x51343d(0x25f)]('Delete\x20enrollment\x20error:',_0x590a1f),_0x40a390[_0x51343d(0x224)](0x1f4)[_0x51343d(0x1ce)](_0x51343d(0x271));_0x40a390['redirect']('/enrollments');});}),app['post'](a0_0x520bbb(0x1ab),checkAuthenticated,authenticateRole(a0_0x520bbb(0x1c3)),(_0xf6fe70,_0x300b77)=>{const _0x227007=a0_0x520bbb,{student_id:_0x59f0c1,amount:_0x238f0f,payment_date:_0x15cfd0}=_0xf6fe70[_0x227007(0x230)];if(!_0x59f0c1||!_0x238f0f||!_0x15cfd0)return _0x300b77['status'](0x190)[_0x227007(0x1ce)](_0x227007(0x1d7));const _0x74109d=_0x227007(0x299);sql[_0x227007(0x276)](connectionString,_0x74109d,[_0x59f0c1,_0x238f0f,_0x15cfd0],_0x15d51f=>{const _0x1a2037=_0x227007;if(_0x15d51f)return console['error'](_0x1a2037(0x290),_0x15d51f),_0x300b77['status'](0x1f4)['send']('Database\x20error');_0x300b77[_0x1a2037(0x288)](_0x1a2037(0x1ca));});}),app['get'](a0_0x520bbb(0x1ca),checkAuthenticated,authenticateRole(a0_0x520bbb(0x1c3)),(_0x2af0cf,_0x1e25e7)=>{const _0x16f45c=a0_0x520bbb,_0xb08ef8=_0x16f45c(0x287);sql[_0x16f45c(0x276)](connectionString,_0xb08ef8,(_0x35e73b,_0xf57fc5)=>{const _0x3cdf15=_0x16f45c;if(_0x35e73b)return console['error'](_0x3cdf15(0x21d),_0x35e73b),_0x1e25e7[_0x3cdf15(0x224)](0x1f4)[_0x3cdf15(0x1ce)](_0x3cdf15(0x210));_0x1e25e7['render']('payments.ejs',{'payments':_0xf57fc5,'user':_0x2af0cf['user']});});}),app[a0_0x520bbb(0x22d)](a0_0x520bbb(0x204),checkAuthenticated,authenticateRole(a0_0x520bbb(0x1c3)),(_0x3d8625,_0x10e23a)=>{const _0x12f884=a0_0x520bbb,_0x7e38d5=_0x3d8625['params']['id'],_0x265211=_0x12f884(0x269),_0x557876=_0x12f884(0x1b6);sql[_0x12f884(0x276)](connectionString,_0x265211,[_0x7e38d5],(_0x5d19c7,_0x4415df)=>{const _0x4645ea=_0x12f884;if(_0x5d19c7||_0x4415df['length']===0x0)return _0x10e23a[_0x4645ea(0x224)](0x194)[_0x4645ea(0x1ce)](_0x4645ea(0x256));const _0x175040=_0x4415df[0x0];sql[_0x4645ea(0x276)](connectionString,_0x557876,(_0x2eb71a,_0x7f000c)=>{const _0x12223b=_0x4645ea;if(_0x2eb71a)return _0x10e23a[_0x12223b(0x224)](0x1f4)[_0x12223b(0x1ce)](_0x12223b(0x1dc));_0x10e23a['render'](_0x12223b(0x225),{'payment':_0x175040,'students':_0x7f000c,'user':_0x3d8625[_0x12223b(0x1c8)]});});});}),app['post']('/payments/:id',checkAuthenticated,authenticateRole(a0_0x520bbb(0x1c3)),(_0x20a837,_0x24f460)=>{const _0x1ee658=a0_0x520bbb,{student_id:_0x27609d,amount:_0x514ebe,payment_date:_0x8500b2}=_0x20a837[_0x1ee658(0x230)],_0x5dfbf9='\x0a\x20\x20\x20\x20UPDATE\x20payments\x0a\x20\x20\x20\x20SET\x20student_id\x20=\x20?,\x20amount\x20=\x20?,\x20payment_date\x20=\x20?\x0a\x20\x20\x20\x20WHERE\x20id\x20=\x20?\x0a\x20\x20';sql[_0x1ee658(0x276)](connectionString,_0x5dfbf9,[_0x27609d,_0x514ebe,_0x8500b2,_0x20a837[_0x1ee658(0x259)]['id']],_0x192fa5=>{const _0x5b8dd5=_0x1ee658;if(_0x192fa5)return console['error'](_0x5b8dd5(0x22f),_0x192fa5),_0x24f460[_0x5b8dd5(0x224)](0x1f4)[_0x5b8dd5(0x1ce)](_0x5b8dd5(0x1e4));_0x24f460[_0x5b8dd5(0x288)]('/payments');});}),app[a0_0x520bbb(0x27d)]('/payments/:id',checkAuthenticated,authenticateRole(a0_0x520bbb(0x1c3)),(_0x3ea663,_0x52d114)=>{const _0x19a20d=a0_0x520bbb,_0x2ffd38=_0x19a20d(0x20d);sql[_0x19a20d(0x276)](connectionString,_0x2ffd38,[_0x3ea663['params']['id']],_0x477bb6=>{const _0x1f5572=_0x19a20d;if(_0x477bb6)return console[_0x1f5572(0x25f)](_0x1f5572(0x28f),_0x477bb6),_0x52d114[_0x1f5572(0x224)](0x1f4)['send'](_0x1f5572(0x271));_0x52d114[_0x1f5572(0x288)]('/payments');});}),app['get']('/payments/new',checkAuthenticated,authenticateRole('admin'),(_0x34e287,_0x41d4e0)=>{const _0x144725=a0_0x520bbb;_0x41d4e0['render'](_0x144725(0x265),{'user':_0x34e287[_0x144725(0x1c8)]});}),app['get'](a0_0x520bbb(0x21f),checkAuthenticated,authenticateRole('admin'),(_0x3b0e6b,_0x57071a)=>{const _0x1d44d1=a0_0x520bbb;_0x57071a[_0x1d44d1(0x277)]('Addenrollments.ejs',{'user':_0x3b0e6b[_0x1d44d1(0x1c8)]});}),app[a0_0x520bbb(0x22d)](a0_0x520bbb(0x1bb),authenticateRole([a0_0x520bbb(0x1c3),'teacher']),checkAuthenticated,(_0x45fc93,_0x2b9be6)=>{const _0x9e2880=a0_0x520bbb;_0x2b9be6[_0x9e2880(0x277)](_0x9e2880(0x1f8));}),app[a0_0x520bbb(0x22d)](a0_0x520bbb(0x1bd),checkAuthenticated,authenticateRole([a0_0x520bbb(0x1c3),'teacher']),(_0x188930,_0x439c3a)=>{const _0x2e86e5=a0_0x520bbb;_0x439c3a[_0x2e86e5(0x277)](_0x2e86e5(0x1d8),{'user':_0x188930[_0x2e86e5(0x1c8)]});});function checkAuthenticated(_0x40de6b,_0xc46faa,_0x3eb61f){const _0x32655f=a0_0x520bbb;if(_0x40de6b[_0x32655f(0x1ae)]())return _0x3eb61f();_0xc46faa[_0x32655f(0x288)](_0x32655f(0x1ff));}function checkNotAuthenticated(_0x3164c2,_0x2ec95e,_0x15c41e){const _0x1c3e35=a0_0x520bbb;if(_0x3164c2[_0x1c3e35(0x1ae)]())return _0x2ec95e[_0x1c3e35(0x288)]('/');_0x15c41e();}app[a0_0x520bbb(0x260)](0xbb8);